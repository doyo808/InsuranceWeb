<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kd.insuranceweb.admin.mapper.AdminDashboardMapper">

	<!-- ðŸ“Œ KPI -->


	<select id="countPendingContracts" resultType="int">
		SELECT COUNT(*)
		FROM INSURANCE_CONTRACTS
		WHERE STATUS = 'PENDING'
	</select>

	<select id="countPendingClaims" resultType="int">
		SELECT COUNT(*)
		FROM CLAIMS
		WHERE CLAIM_STATUS = 1
	</select>


	<!-- ðŸ“Š ì´ë²ˆ ë‹¬ ê³„ì•½ í†µê³„ -->
	<select id="countNewContractsThisMonth" resultType="int">
		SELECT COUNT(*)
		FROM INSURANCE_CONTRACTS
		WHERE EXTRACT(YEAR FROM START_DATE) = EXTRACT(YEAR FROM SYSDATE)
		AND EXTRACT(MONTH FROM START_DATE) = EXTRACT(MONTH FROM SYSDATE)
	</select>

	<!-- ðŸ†• ì´ë²ˆ ë‹¬ ì¢…ë£Œ(ë§Œë£Œ) ê³„ì•½ ê±´ìˆ˜ -->
	<select id="countEndedContractsThisMonth" resultType="int">
		SELECT COUNT(*)
		FROM INSURANCE_CONTRACTS
		WHERE EXTRACT(YEAR FROM END_DATE) = EXTRACT(YEAR FROM SYSDATE)
		AND EXTRACT(MONTH FROM END_DATE) = EXTRACT(MONTH FROM SYSDATE)
	</select>


	<!-- ðŸ’° ì´ë²ˆ ë‹¬ ì²­êµ¬ í†µê³„ -->
	<select id="sumClaimsThisMonth" resultType="int">
		SELECT NVL(SUM(CLAIM_AMOUNT), 0) / 10000
		FROM CLAIMS
		WHERE EXTRACT(YEAR FROM CLAIM_DATE) = EXTRACT(YEAR FROM SYSDATE)
		AND EXTRACT(MONTH FROM CLAIM_DATE) = EXTRACT(MONTH FROM SYSDATE)
	</select>

	<select id="sumApprovedClaimsThisMonth" resultType="int">
		SELECT NVL(SUM(CLAIM_AMOUNT), 0) / 10000
		FROM CLAIMS
		WHERE CLAIM_STATUS = 2
		AND EXTRACT(YEAR FROM CLAIM_DATE) = EXTRACT(YEAR FROM SYSDATE)
		AND EXTRACT(MONTH FROM CLAIM_DATE) = EXTRACT(MONTH FROM SYSDATE)
	</select>

	<!-- ðŸ•“ ìµœê·¼ ê´€ë¦¬ìž í™œë™ -->
	<select id="selectRecentActivities" resultType="map">
		SELECT
		TO_CHAR(a.CREATED_AT, 'YYYY-MM-DD HH24:MI') AS CREATED_AT,
		a.ACTION_DESC,
		e.EMPLOYEE_NAME
		FROM ADMIN_ACTIVITY_LOG a
		JOIN EMPLOYEES e ON a.EMP_ID = e.EMP_ID
		ORDER BY a.CREATED_AT DESC
		FETCH FIRST 5 ROWS ONLY
	</select>

</mapper>
