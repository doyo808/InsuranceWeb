<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/admin/common/layout}">

<head>
	<meta charset="utf-8" />
	<title>보험금 청구 관리 - 관리자</title>
	
</head>

<body>
	<main layout:fragment="adminContent" class="admin-main">
		<h1 class="page-title">보험금 청구 관리</h1>
		<p class="page-desc">모든 보험금 청구 건을 한 곳에서 관리하고 처리합니다.</p>

		<section class="stats">
			<article class="stat-card panel">
				<p class="stat-card__label">신규 청구 건수</p>
				<p class="stat-card__value" th:text="${pendingCount} + '건'"></p>
			</article>
		</section>

		<section class="toolbar card">
			<form class="toolbar__row" method="get" th:action="@{/admin/claim}">
				<div class="field toolbar__item">
					<label class="field__label" for="q">검색어</label>
					<input id="q" class="field__control" type="text" name="q" placeholder="청구 ID, 고객 이름으로 검색"
						th:value="${criteria.q}">
				</div>

				<div class="field toolbar__item">
					<label class="field__label" for="claimType">청구 유형</label>
					<select id="claimType" class="field__control" name="claimType">
						<option value="">청구 유형 전체</option>
						<option value="신규접수" th:selected="${criteria.claimType} == '신규접수'">신규접수</option>
						<option value="질병보험" th:selected="${criteria.claimType} == '질병보험'">질병보험</option>
						<option value="자동차보험" th:selected="${criteria.claimType} == '자동차보험'">자동차보험</option>
					</select>
				</div>

				<div class="field toolbar__item">
					<label class="field__label" for="status">처리 상태</label>
					<select id="status" class="field__control" name="status">
						<option value="">처리 상태 전체</option>
						<option value="1" th:selected="${criteria.status} == 1">접수</option>
						<option value="2" th:selected="${criteria.status} == 2">지급완료</option>
						<option value="3" th:selected="${criteria.status} == 3">취소</option>
					</select>
				</div>

				<div class="field toolbar__item toolbar__item--grow">
					<label class="field__label">접수일자</label>
					<div class="daterange" data-daterange>
						<input class="field__control daterange__input" type="date" name="from"
							th:value="${#temporals.format(criteria.from, 'yyyy-MM-dd')}">
						<span class="daterange__sep">~</span>
						<input class="field__control daterange__input" type="date" name="to"
							th:value="${#temporals.format(criteria.to, 'yyyy-MM-dd')}">
					</div>
				</div>

				<div class="toolbar__spacer"></div>

				<div class="toolbar__actions">
					<button type="button" class="btn btn--ghost" id="btnReset">초기화</button>
					<button type="submit" class="btn btn--primary">조회</button>
				</div>
			</form>
		</section>

		<!-- 목록 테이블 -->
		<section class="table-wrap mt-12">
			<table class="table">
				<thead>
					<tr>
						<th scope="col">청구 ID</th>
						<th scope="col">고객명</th>
						<th scope="col">청구 유형</th>
						<th scope="col">사고 날짜</th>
						<th scope="col">접수 날짜</th>
						<th scope="col">처리 상태</th>
						<th scope="col">상세보기</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="row : ${claims}">
						<td th:text="'#' + ${row.claim_id}"></td>
						<td th:text="${row.person_name}"></td>
						<td th:text="${row.claim_type}"></td>
						<td th:text="${#temporals.format(row.accident_date, 'yyyy-MM-dd')}"></td>
						<td th:text="${#temporals.format(row.claim_date,    'yyyy-MM-dd')}"></td>

						<!-- 상태 뱃지: 값에 따라 클래스 바꾸기 -->
						<td>
							<span class="badge" th:classappend="${row.claim_status} == 1 ? ' badge--pending' :
													                        (${row.claim_status} == 2 ? ' badge--approved' :
													                        (${row.claim_status} == 3 ? ' badge--rejected' : ''))"
								th:switch="${row.claim_status}">
								<span th:case="1">접수</span>
								<span th:case="2">지급완료(종결)</span>
								<span th:case="3">접수취소</span>
								<span th:case="*">-</span>
							</span>
						</td>

						<td class="text-center">
							<a th:href="@{/admin/claimDetail(claimId=${row.claim_id})}">상세정보</a>
						</td>
				</tbody>
			</table>
		</section>

		<app-pagination th:attr="current=${page},
		           total-items=${totalCount},
		           per-page=${size},      
		           window=5,
		           href=@{/admin/claim} + '?page={page}'" preserve-query>
		</app-pagination>

		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const form = document.querySelector('.toolbar__row');
				const btnReset = document.getElementById('btnReset');

				btnReset.addEventListener('click', () => {
					// 값만 초기화
					form.querySelector('[name="q"]').value = '';
					form.querySelector('#claimType').value = '';
					form.querySelector('#status').value = '';
					form.querySelector('[name="from"]').value = '';
					form.querySelector('[name="to"]').value = '';

					// 선택 1) 화면만 값 초기화하고, 목록은 그대로 두고 싶다면 여기서 끝.
					return;

					// 선택 2) 값 초기화 후 "현재 페이지 그대로" 재조회하고 싶다면 submit 실행
					// form.submit();
				});
			});
		</script>


	</main>
</body>

</html>